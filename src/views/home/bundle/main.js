(()=>{"use strict";async function e(e,n=""){const t=`${e}/${n}`;console.log(`%cGET 요청: ${t} `,"color: #a25cd1;");const o=await fetch(t,{headers:{Authorization:`Bearer ${sessionStorage.getItem("token")}`}});if(!o.ok){const e=await o.json(),{reason:n}=e;throw new Error(n)}return await o.json()}async function n(e,n="",t){const o=`${e}/${n}`,i=JSON.stringify(t);console.log(`%cPATCH 요청: ${o}`,"color: #059c4b;"),console.log(`%cPATCH 요청 데이터: ${i}`,"color: #059c4b;");const a=await fetch(o,{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:`Bearer ${sessionStorage.getItem("token")}`},body:i});if(!a.ok){const e=await a.json(),{reason:n}=e;throw new Error(n)}return await a.json()}const t=()=>{if(!sessionStorage.getItem("token")){const e=window.location.pathname,n=window.location.search;window.location.replace(`/login?previouspage=${e+n}`)}},o=document.querySelector(".section_box"),i=sessionStorage.getItem("token");!async function(){const a=await fetch("api/products");(await a.json()).forEach((a=>{const c=a.brand,s=a.name,r=a.price,l=a.img,d=a.category,p=a.description,u=a.num,g=a.like;o.insertAdjacentHTML("beforeend",`\n    <section class="pd_block" id="${d}">\n    <img src="${l}"class="box" id="${u}"/>\n    <article class="pd_text">\n      <p class="pd_brd" id="${c}">${c}</p>\n      <p class="pd_name" id="${s}">${s}</p>\n      <div class="tag_box">\n      <div>\n        <a class="tag_category">${d}</a>\n        <a class="tag_name" id="${p}">${p}</a>\n      </div>\n      <p class="pd_price">${r} 원</p>\n      </div>\n      <div class="tag_like">\n          <img class="like_src" src="../image/like.png" alt="" width="30px" id="like_${u}"> \n          <p class="like_count" id="likeCount_${u}">${g}</p>\n      </div>\n    </article>\n  </section>\n    `);const k=document.getElementById(`${u}`),w=document.getElementById(`like_${u}`),m=document.getElementById(`likeCount_${u}`);k.addEventListener("click",(function(){window.location.assign(`/productDetail/${u}`)})),w.addEventListener("click",(async function(o){o.preventDefault(),"like.png"===w.src.split("/")[4]?async function(o){if(o.preventDefault(),i){t();let o=await e("/api/user");const{likeProduct:i}=o,a=o._id,c={num:u,like:g};i.push(u);const s=g+1;g!=s&&(c.like=s,await n("/api/products",u,c),await n("/api/usersLike/like",a,{likeProduct:i}),m.innerText=c.like,w.src="../image/like_hover.png")}else alert("로그인이 필요합니다."),window.location.href="/login"}(o):async function(o){if(o.preventDefault(),i){t();let o=await e("/api/user");const{likeProduct:i}=o,a=o._id,c={num:u,like:g};i.pop(u),g!=g-1&&(c.like=g,await n("/api/products",u,c),await n("/api/usersLike/like",a,{likeProduct:i}),m.innerText=c.like,w.src="../image/like.png")}else alert("로그인이 필요합니다."),window.location.href="/login"}(o)}))}));const c=document.querySelector("#logout1"),s=document.querySelector("#logout2");c.addEventListener("click",(()=>{sessionStorage.removeItem("token"),window.location.href="/"})),s.addEventListener("click",(()=>{sessionStorage.removeItem("token"),window.location.href="/"}))}()})();